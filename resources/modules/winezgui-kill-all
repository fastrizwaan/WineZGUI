WineZGUI_Kill_All()
{
  DBUG "I: $(basename ${0}): Launched ${FUNCNAME[0]}"
  DBUG "I: $(basename ${0}): Kill all: exiting ${APPNAME}!"
  echo "---------------------${FUNCNAME[0]}-------------------------"
  source "${DATADIR}/script-check-variables-loaded-or-not"
  Script_Check_Variables_Loaded_Or_Not

  # Check if --talk-name=org.freedesktop.Flatpak is allowed
  if [ ${INSTALL_TYPE} = "flatpak" ] && [ "${WINE_CMD}" = "/app/bin/wine" ]; then
       TEXT+="WineZGUI needs to stop ${FLATPAK_NAME} from the system to exit all instances.\n"
       TEXT+="Temporary: <b>flatpak run --talk-name=org.freedesktop.Flatpak ${FLATPAK_NAME}</b>\n"
       TEXT+="Permanent: <b>flatpak override --user --talk-name=org.freedesktop.Flatpak ${FLATPAK_NAME}</b>\n"
       flatpak-spawn --host pwd 1>/dev/null || \
       (echo "E: $(basename ${0}): Kill all: needs to access system to run flatpak kill ${FLATPAK_NAME} via flatpak-spawn";\
        zenity --error --title="${APP_WITH_VER}: System Access Required!" --text="${TEXT}" )

  fi

  # for killing all wine instance from flaptak sandbox
  if [ $(flatpak-spawn echo 0 2>/dev/null) ] ; then
       # flatpak wine and winezgui will be killed
       flatpak-spawn --host flatpak kill ${FLATPAK_NAME}
  else
       # Find all process which ends with .exe and kill them
       WINE_PROCESSES=$( ps -aux     | \
                 grep -i "\.exe"     | \
                 sed "s/\( \)*/\1/g" | \
                 cut -f2 -d " "      )
       for PROCESS in ${WINE_PROCESSES}; do
            kill -9 ${PROCESS} 2>/dev/null
       done
       # also kill wineserver to kill explorer, etc.
       wineserver -k
       # exit winezgui also for consistent behavior with flatpak
       # else host will not exit, but flatpak version will exit
       # on using Kill all process
       exit 0
  fi
}
