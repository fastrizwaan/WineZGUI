#  using flatpak install and script is running from flatpak container
# Check if it is a flatpak based script
# Check if it is running from inside flatpak container
# and gnome terminal is found on host
Script_Open_Shell()
{
  DBUG "I: Script: Launched ${FUNCNAME[0]}"
  echo "---------------------${FUNCNAME[0]}-------------------------"
  source "${WINEZGUI_SCRIPTS}/script-check-variables-loaded-or-not"
  Script_Check_Variables_Loaded_Or_Not


  # Check if --talk-name=org.freedesktop.Flatpak is allowed
  if [ ${INSTALL_TYPE} = "flatpak" ] && [ "${WINE_CMD}" = "/app/bin/wine" ]; then
       TEXT+="WineZGUI needs to Launch gnome-terminal from the system.\n"
       TEXT+="Temporary: <b>flatpak run --talk-name=org.freedesktop.Flatpak ${FLATPAK_NAME}<.b>\n"
       TEXT+="Permanent: <b>flatpak override --user --talk-name=org.freedesktop.Flatpak ${FLATPAK_NAME}<.b>\n"
       flatpak-spawn --host pwd 1>/dev/null || \
       (echo "E: Open Terminal: Gnome-terminal needs to access system via flatpak-spawn";\
        zenity --error --title="${APP_WITH_VER}: System Access Required!" --text="${TEXT}" )

  fi

  if   [ ${INSTALL_TYPE} = "flatpak" ] && \
       [ $(flatpak-spawn --host which gnome-terminal) ]; then
         DBUG "I: Script: Open Shell: Flatpak script, running from sandbox"
         flatpak-spawn --host gnome-terminal --wait -- \
         flatpak run --command=bash ${FLATPAK_NAME} -c \
         "export WINEPREFIX=\"${PREFIXDIR}\"; \
         cd \"${WINEPREFIX}\"; exec bash -i;"

       # If flatpak install and script running from host
       # and gnome terminal is found
  elif [ ${INSTALL_TYPE} = "flatpak" ] && \
       [ $(which gnome-terminal) ]; then
         export WINEPREFIX="${PREFIXDIR}";
         DBUG "I: Script: Open Shell: Flatpak script, running from host"
         gnome-terminal --wait -- flatpak  \
         --command=bash run ${FLATPAK_NAME} -c \
         "cd \"${PREFIXDIR}\"; exec bash -i"

       # Else it is a host install and gnome-terminal is found
  elif [ ${INSTALL_TYPE} = "system" ] && \
       [ $(which gnome-terminal) ]; then
         DBUG "I: Script: Open Shell: System script, running from host"
         export WINEPREFIX="${PREFIXDIR}";
         gnome-terminal --wait -- bash -c \
         "cd \"${WINEPREFIX}\"; exec bash -i"
         # gnome terminal is not found
  else
         DBUG "I: Script: Open Shell: Gnome-terminal not found"
         ${ZENITY_CMD} --title "${SELECTION}" --width=500 --height=30 --info  \
                --text "This feature requires \"gnome-terminal\""
  fi
}
